/**
 * Copyright 2014-2015 Evernote Corporation. All rights reserved.
 */
var EvernoteClipper=function(e,t){function n(e){var t={};for(var n in e)t[n]=e[n];return t}function r(t,n,r,o){if(e.document.querySelector)return e.document.querySelector(t+"["+n+"='"+r+"']["+o+"]");for(var a=e.document.getElementsByTagName(t),i=0;i<a.length;i++)if(a[i][n]===r&&a[i][o])return a[i];return null}function o(e){return"string"==typeof e?e.replace(/[<>"'`&]/g,function(e){return"&"===e?"&amp;":"<"===e?"&lt;":">"===e?"&gt;":'"'===e?"&quot;":"'"===e?"&#39;":"`"===e?"&#96;":void 0}):e}function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function i(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function c(){for(var t=e.document.getElementsByTagName("script"),n=t.length-1;n>=0;n--){var r=t[n].src,o=/\/widget\.js(\?.*?yxbj=true(?:$|&))?/i.exec(r),a=/^https?:\/\/(?:app\.yinxiang|(?:www|(cdn1)|stage(?:-china)?)\.evernote)\.com/i.exec(r);if(o&&a)return a[1]?o[1]?"https://app.yinxiang.com":"https://www.evernote.com":a[0]}return"https://www.evernote.com"}function l(e,t){if(e.getElementsByClassName)return e.getElementsByClassName(t);if(e.querySelectorAll)return e.querySelectorAll("."+t);for(var n=[],r=new RegExp("(^|\\s)"+t+"(\\s|$)"),o=e.getElementsByTagName("*"),a=0;a<o.length;a++)r.test(o[a].className)&&n.push(o[a]);return n}function u(e){var t=e.authors;if(!t){var n=r("meta","name","author","content");n&&(t=n.content)}return t}function d(t,n){if(t.contentHTML){var r=document.createElement("iframe");r.style.cssText="display:block!important;height:1px!important;position:static!important;width:1px!important",document.body.appendChild(r),r.onload=function(e){var t=this;if(t.nodeName||(t=e.srcElement),t&&t.parentNode){var r=t.contentDocument||t.contentWindow.document;n(m(r.body)),t.parentNode.removeChild(t)}},r.attachEvent&&r.attachEvent("onload",r.onload);var o=r.contentDocument||r.contentWindow.document;o.open(),o.write("<body>"+t.contentHTML+"</body>"),o.close()}else if(t.contentId){var a=e.document.getElementById(t.contentId);a&&n(m(a))}}function m(n){if(!t.noClientSideImageConversion){var r=n.getElementsByTagName("img"),o=e.document.createElement("canvas");if("getContext"in o){e.location.origin||(e.location.origin=e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:""));for(var a=new RegExp("^"+e.location.origin.replace(/\//g,"\\/").replace(/\./g,"\\.")),i=[],c=0;c<r.length;c++)if(r[c].naturalWidth||r[c].naturalHeight){if(a.test(r[c].src)){o.width=r[c].width||1,o.height=r[c].height||1,o.getContext("2d").drawImage(r[c],0,0,o.width,o.height);try{var l=o.toDataURL();l.length+n.outerHTML.length<y&&(r[c].src=l)}catch(u){}}}else"FIGURE"===r[c].parentNode.nodeName&&i.push(r[c].parentNode);for(var c=0;c<i.length;c++)i[c]&&i[c].parentNode&&i[c].parentNode.removeChild(i[c])}}return n.innerHTML}function s(e){if(e.dateExact)return e.dateExact;var t=e.date;if(!t){var n=r("meta","itemprop","datePublished","content");n&&(t=n.content)}var o=new Date(t)-0;return isNaN(o)&&(o=Date.parseISOString(t),isNaN(o))?null:o}function p(e){var t=e.summary;if(!t){var n=r("meta","name","article.summary","content");n?t=n.content:(n=r("meta","property","og:description","content"),n&&(t=n.content))}return t}function f(t){var n=t.title;if(!n){var o=r("meta","property","og:title","content");n=o?o.content:e.document.title}return n}function h(t){var n=t.url;if(!n){var o=r("link","rel","canonical","href");if(o)n=o.href;else{var a=r("meta","property","og:url","content");n=a?a.content:e.location.href}}return n}function v(){return navigator&&navigator.userAgent?/(?:Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/i.test(navigator.userAgent):!1}function g(r){var a="evernoteClipWindow";v()&&(a+=i());var l=window.open("",a,"width=360,height=336,scrollbars=yes,top="+r.screenY+",left="+r.screenX);l&&l.focus();var m=this;if(!m.nodeName)for(m=r.srcElement;!/(^|\s)evernote-clip-button($|\s)/.test(m.className);)m=m.parentNode;var g=e.EVERNOTE_CLIP_INFO[m.getAttribute("data-id")],y=f(g),N=h(g),w=p(g),E=e.document.createElement("form");E.action=c()+"/ClipNCite.action",E.method="post",E.enctype="multipart/form-data",E.encoding="multipart/form-data",E.acceptCharset="UTF-8",E.target=a;var b=e.document.createElement("input");if(b.name="title",b.value=y,E.appendChild(b),b=e.document.createElement("input"),b.name="url",b.value=N,E.appendChild(b),t.referralCode){if(t.referralCode.length>9)throw new Error("Referral code must between 0 - 9 letters, inclusive")}else t.referralCode="";b=e.document.createElement("input"),b.name="code",b.value="clip_w_"+t.referralCode,E.appendChild(b);var C=e.document.createElement("textarea");C.name="content",d(g,function(e){var r=n(g);r.title=o(y),r.date=s(g),r.authors=o(u(g)),r.summary=o(w),r.body=e,r.url=o(N),C.value=t.format(r),E.appendChild(C),E.style.cssText="display:none!important",document.body.appendChild(E),E.submit(),document.body.removeChild(E)})}var y=5e5;v()&&(y=1e5),Date.parseISOString=function(e){function t(e,t){var n=[0,31,59,90,120,151,181,212,243,273,304,334,365],r=t>1?1:0;return n[t]+Math.floor((e-1969+r)/4)-Math.floor((e-1901+r)/100)+Math.floor((e-1601+r)/400)+365*(e-1970)}function n(e){return Number(new Date(1970,0,1,0,0,0,e))}var r=/^(\d{4}|[\+\-]\d{6})(?:-(\d{2})(?:-(\d{2})(?:T(\d{2}):(\d{2})(?::(\d{2})(?:(\.\d{1,}))?)?(Z|(?:([\-\+])(\d{2}):(\d{2})))?)?)?)?$/,o=r.exec(e);if(o){var a,i=Number(o[1]),c=Number(o[2]||1)-1,l=Number(o[3]||1)-1,u=Number(o[4]||0),d=Number(o[5]||0),m=Number(o[6]||0),s=Math.floor(1e3*Number(o[7]||0)),p=Boolean(o[4]&&!o[8]),f="-"===o[9]?1:-1,h=Number(o[10]||0),v=Number(o[11]||0);return(d>0||m>0||s>0?24:25)>u&&60>d&&60>m&&1e3>s&&c>-1&&12>c&&24>h&&60>v&&l>-1&&l<t(i,c+1)-t(i,c)&&(a=60*(24*(t(i,c)+l)+u+h*f),a=1e3*(60*(a+d+v*f)+m)+s,p&&(a=n(a)),a>=-864e13&&864e13>=a)?a:0/0}return Date.parse.apply(this,arguments)};for(var N=l(e.document,"evernote-clip-button"),w=0;w<N.length;w++)N[w].addEventListener?N[w].addEventListener("click",g):N[w].attachEvent("onclick",g);return t.clickHandler=g,t}(window,EvernoteClipper||{});